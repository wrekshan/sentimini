{% load static %}



<nav>
  <div class="nav-wrapper z-depth-1">
    <div class="row">
      <div class="col l12 s12">
        <div class="col s8">
          <a href="#!" class="brand-logo">Browse or add collections of texts</a> 
        </div>

        <a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons">menu</i></a>

        <ul class="right hide-on-med-and-down">
         <ul class="right hide-on-med-and-down">
          <li>
            <a class="waves-effect waves-light btn" href="/ent/collection_create_scaffold/" >Create a collection</a>
          </li>
        </ul>
      </ul>
    </div>
  </div>
</div>
</nav>


<div class="row cyan">
  <div class="col s12 m10 offset-m1">


    <!-- SEARCH BAR -->
    <div class="row">
      <form class="col s12">
        <div class="input-field col s12">
          <i class="material-icons prefix tooltipped" data-position="top" data-delay="50" data-tooltip="These are tags for categorization">search</i>
          <div class="row">
           <select id="collection_text" multiple="multiple">
             {% for tag in working_tags %}
             <option value="{{tag.tag}}">{{tag.tag}}</option>
             {% endfor %}
          <!-- {% for topic in topics %}
          <option value="topic_{{topic.id}}">{{topic.topic_name}}</option>
          {% endfor %} -->
        </select>
      </div>
    </div>
  </form>
</div>

<div class="switch">
  <label>
    All collections
    {% if collection_switch_check %}
    <input type="checkbox" id="collection_switch" checked="">
    {% else %}
    <input type="checkbox" id="collection_switch">
    {% endif %}
    <span class="lever"></span>
    Only my collections
  </label>
</div>


<div id="possible_text_list">
  <!-- Switch -->

  <p>
    Sort by:
    <div class="waves-effect btn chip sort red lighten-2" data-sort="text-text">
      Text
    </div>

    <div class="waves-effect btn chip sort red lighten-2" data-sort="time_sent">
      Date
    </div>

    <div class="waves-effect btn chip sort red lighten-2" data-sort="response">
      Response
    </div>
  </p>


  <div class="row ">
    <div class="col s10 m10 offset-s1 offset-m1">
      <div id="lens_filter_options"></div>
    </div>
  </div>

  <ul class="list">
    {% for key, value in collection_info %}
    <div class="col s12 m12">
      <div class="card">
            <!-- <div class="card-image">
               <div style="width:100%;height:800">
                {{ value.heatmap|safe }}
              </div>
              <span class="card-title">Card Title</span>
            </div> -->


            <div class="card-content">
              <span class="card-title text-text"  style="line-height: normal;">{{value.collection.collection}}</span>
              <div class="row"></div>
              <!-- Texts per day: <span class="time_sent">{{value.text.time_sent}}</span> </br>
              Numer of texts:: <span class="time_response">{{value.text.time_response}}</span></br> -->
              <div class="row"></div>
              <span class="response">  {{value.collection.description}}</span>
              <div class="row"></div>

              XXXX people have signed up for this collection

              
              <li>

              <table class="striped">
                <thead>
                  <tr>
                    <th data-field="remove"></th>
                    <th data-field="id">Text</th>
                    <th data-field="name">Summary</th>
                  </tr>
                </thead>

                <tbody>
                  {% for text in value.collection.texts.all %}
                  <tr>
                    <td><input name="{{value.collection.id}}_{{text.id}}" type="checkbox" id="{{value.collection.id}}_{{text.id}}" checked>
                      <label for="{{value.collection.id}}_{{text.id}}" id="{{value.collection.id}}_{{text.id}}" class="">
                      </td>

                      <td>{{text.text}}</td>
                      <td>{{text.timing.repeat_summary}}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
              </table>
              </li>




              </div>
              <div class="card-action">
                <a href="#">Add collection (selected texts)</a>
                {% if value.collection.user == user %}
                <a href="/ent/collection_create_scaffold/{{value.collection.id}}">Edit collection</a>
                {% endif %}

              </div>
            </div>
          </div>
          {% endfor %}
        </ul>
        <div class="col s10">
          <ul class="pagination"></ul>
        </div>
      </div>
    </div>



    <!-- FOR THE CHECKBOXES -->
    {% for key, value in collection_info %}
    {% for text in value.collection.texts.all %}
    <script type="text/javascript">
      $('input[name={{value.collection.id}}_{{text.id}}]').click(function() {
        $('#{{value.collection.id}}_all').removeAttr('checked');
      });

      $('#{{value.collection.id}}_all').click(function() {
        $('input[name={{value.collection.id}}_{{text.id}}]').removeAttr('checked');  
      });
    </script>
    {% endfor %}
    {% endfor %}

    <!-- THIS IS THE COLLAPISBLE -->
    <script type="text/javascript">
     $(document).ready(function(){
      $('.collapsible').collapsible();
    });

  </script>

  <!-- SELECT@ -->
  <script src={% static "js/select2.full.min.js" %}></script>
  <script>
    $("#collection_text").select2({
      tags: true,
      tokenSeparators: [',', ' ']
    })
  </script>


  <script type="text/javascript">
// var options = {
//   valueNames: [ 'text-text', 'text_id' ]
// };

// var userList = new List('possible_text_list', options);


var monkeyList = new List('possible_text_list', {
  valueNames: ['text-text', 'time_sent',''],
  page: 5,
  plugins: [ ListPagination({}) ] 
});
</script>


<script type="text/javascript">
$('#collection_switch').change(function(){
  $.ajax({
    type: 'POST',
    url: '/ent/get_display_collection/',
    data: {'csrfmiddlewaretoken': '{{ csrf_token }}',
    'collection_switch': $('#collection_switch').is(':checked')},

     success : function(data) {
      console.log("COLLECTION DISPLAY WORKED!")
             $('#MAIN').html(data['COLLECTION']);
         }
})
    })
</script>