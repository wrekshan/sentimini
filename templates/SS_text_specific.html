{% extends "SS_base.html" %}
{% load static %}
{% load staticfiles %}
{% block content %}

<head>
 <title>Text | Sentimini</title>
 <meta property="og:title"         content="Text | Sentimini | View programs and sign up for texts"/>
 <meta property="og:url"           content="www.sentimini.com/consumer/program/" />
 <meta property="og:type"          content="website" />
 <meta property="og:description"   content="View programs and sign up for texts.  Lightweight tools for mindfulness, behavior change, and learning about this world." />
 <meta property="og:image"         content="http://www.your-domain.com/path/image.jpg" />
</head>


<!-- <script src="http://listjs.com/assets/javascripts/list.min.js"></script> -->
<script src={% static "js/list.min.js" %}></script>
<script src={% static "js/list.pagination.min.js" %}></script>


<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">


<!-- QUICK SUGGESTIONS-->
<div class="row">
  <div class="col s12 m3">
    <span id="NUS_tracker" hidden>0</span>
    <span id="NUS_switch" hidden>0</span>

    <div class="hide-on-med-and-up">
      <div class="row"></div>
      <div class="chip waves-effect waves-teal btn-flat" id ="suggestion-display">Show Suggestions</div>
    </div>
    <div id = "quick_suggestions">
      <div class="card">

        <ul class="collection">

          <li class="collection-item" id = "suggestion_1"><div class = "center-align">
            <div class="row"></div>
            <div id="preloader_new_text" class="preloader-wrapper big active ">
              <div class="spinner-layer spinner-blue-only">
                <div class="circle-clipper left">
                  <div class="circle"></div>
                </div><div class="gap-patch">
                <div class="circle"></div>
              </div><div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>
        </div>
      </div></li>
      <li class="collection-item" id = "suggestion_2"><div class = "center-align">
        <div class="row"></div>
        <div id="preloader_new_text" class="preloader-wrapper big active ">
          <div class="spinner-layer spinner-blue-only">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div><div class="gap-patch">
            <div class="circle"></div>
          </div><div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>
    </div>
  </div></li>
  <li class="collection-item" id = "suggestion_3"><div class = "center-align">
    <div class="row"></div>
    <div id="preloader_new_text" class="preloader-wrapper big active ">
      <div class="spinner-layer spinner-blue-only">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
      <div class="circle"></div>
    </div>
  </div>
</div>
</div></li>

</li>

</ul>
</div>
<!-- <div class="card"> -->
<!-- <div class="card-content"> -->

<a href="/consumer/quotation/">Add your own suggestions</a>
<div class="row"></div>
<a href="/consumer/program/">See more uses of Sentimini</a>

<!-- </div> -->
<!-- </div> -->

</div>
</div>

<div class="col s12 m9">
  <!-- CARD FOR NEW TEXTS AND TIMINGS-->

  <div class="card">
    <div class="card-content">

      <!-- TEXT AND BASIC INFO -->
      <h4>{{working_text.text}}</h4>

      
      <div id="add_text_button">
        {% if user.is_authenticated %}
        {% if user_text  %}
        <div  id = "_{{working_text.id}}" class = "add-text-inspiration-btn waves-effect waves-red btn-flat chip "><span> <i class="material-icons" >delete</i> </span></div>
        {% else %}
        <div  id = "_{{working_text.id}}" class = "add-text-inspiration-btn waves-effect waves-red btn-flat chip "><span> <i class="fa fa-plus" aria-hidden="true"></i> </span></div>
        {% endif %}
        <span id="output_message"></span>
      </div>

      
      {% if user_text %}
      {{user_text.timing.timing_summary}}
      {% else %}
      {{working_text.timing.timing_summary}}
      {% endif %}

      {% else %}
      <a  href="{% url 'account_signup' %}" class = "waves-effect waves-red btn-flat chip" ><i class="fa fa-plus" aria-hidden="true"></i></a>
      {{working_text.timing.timing_summary}}
      <!-- <div style="background-color:#2196f3;" id = "{{working_collection.id}}_{{value.text.id}}" class = "waves-effect waves-teal btn-flat chip">Add -->
      {% endif %}


      
      
      <!-- DESCRIPTIONS IF ANY -->
      {% if working_text.description.all %}
      <div class="row"></div>
      {% for description in working_text.description.all %}
      {{description}}
      {% endfor %}
      {% endif %}

      <!-- Read more -->
      {% if working_text.link.all %}
      <div class="row"></div>
      Read more:
      {% for link in working_text.link.all %}
      <li><a target='_blank' href='{{link.link|safe}}'>{{link.link_display}}</a></li>
      {% endfor %}
      {% endif %}

      {% if working_text.alt_text.all %}
      {% for alt_text in working_text.alt_text.all %}
      <hr> 
      <div class = "row">
      <div class="col s2">
      <b>Alternate</b>:
      </div>
      <div class="col s10"> {{alt_text}}
      {% if alt_text.description.all %}
      <div class="row"></div>
      {% for description in alt_text.description.all %}
      {{description}}
      {% endfor %}
      {% endif %}

      <!-- Read more -->
      {% if alt_text.link.all %}
      <div class="row"></div>
      Read more:
      {% for link in alt_text.link.all %}
      
      <li><a target='_blank' href="{{link.link}}">{{link.link_display}}</a></li>
      
      {% endfor %}
      {% endif %}

</div>
      </div>
      {% endfor %}
      {% endif %}


      <!-- COLLECTIONS -->
      {% if working_text.collection.all %}
      <hr>
      {% for collection in working_text.collection.all %}

      Part of the <a href="/consumer/program/{{collection.id}}/{{collection.slug}}/">{{collection}}</a> program - {{collection.description}}

      {% endfor %}
      {% endif %}
      <div class="row"></div>
      View more <a href="/consumer/program/">programs</a>

      <div class="right-align">
      <btn class="waves-effect waves-light btn smart-back">Back</btn>
      </div>

    </div>
  </div>
  <div id="text_datatable"></div>
</div>
</div>
</div>




<!-- Modal Structure -->
<div id="text_add_confirm" class="modal modal-fixed-footer" style="max-height:50%;">
  <div class="modal-content">
    <h3>Confirm to add text</h3>
    <p>Text: <b>{{working_text.text}}</b></p>

    <p>You will receive <b>{{working_text.timing.timing_summary_burden}}</b> between <b>{{working_text.timing.timing_summary_range}}</b>.</p>

    <p>You can always edit the the text or timings in the scheduled text panel.</p>

  </div>
  <div class="modal-footer">
    <div id = "{{working_collection.id}}_{{working_text.id}}" href="#!" class="modal-action modal-close waves-effect waves-blue btn-flat add-text-inspiration-btn blue darken-2">Confirm</div>
    <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Cancel</a>

  </div>
</div>


<!-- GET THE TEXT BOX -->
<script type="text/javascript">
  function startClock(){
    console.log("STARTING")


     $.ajax({
      type: 'POST',
      url: '/consumer/get_text_datatable_response/',
      data: {'csrfmiddlewaretoken': '{{ csrf_token }}',
      'id': "{{working_text.id}}",
      'text_message': "Viewing Data",
      'find_user_text': "yes",

    },
    success : function(data) {
      // $('#quick_suggestions').html("");
      $('#text_datatable').html('<div class = "center-align"><div class="row"></div><div id="preloader_new_text" class="preloader-wrapper big active "><div class="spinner-layer spinner-blue-only"><div class="circle-clipper left"><div class="circle"></div></div><div class="gap-patch"><div class="circle"></div></div><div class="circle-clipper right"><div class="circle"></div></div></div></div></div>')
        setTimeout(function() {$('#text_datatable').html(data['text_datatable_response']);}, 350);

      
    }
  })










    if ($(window).width()<600){
      $('#quick_suggestions').hide()
      $('#suggestion-display').text("Show Suggestions")

    }

    var save_suggestions = "yes"

    $.ajax({
      type: 'POST',
      url: '/consumer/get_quick_suggestions/',
      data: {'csrfmiddlewaretoken': '{{ csrf_token }}',
      'suggestion_1': "yes",
      'suggestion_2': "yes",
      'suggestion_3': "yes",
      'save_suggestions': save_suggestions,
    },
    success : function(data) {
      setTimeout(function() {$('#suggestion_1').html(data['suggestion_1']);}, 600);
      setTimeout(function() {$('#suggestion_2').html(data['suggestion_2']);}, 600);
      setTimeout(function() {$('#suggestion_3').html(data['suggestion_3']);}, 600);

      if ("{{working_settings.new_user_step}}"=="0"){
        setTimeout(function() {$('#nus_add_suggestion_hightlight_1_trigger').tapTarget('open');}, 1200);
        $('#suggestion-display').text("Hide Suggestions")
        $('#quick_suggestions').show()
        $.ajax({
          type: 'POST',
          url: '/consumer/change_nus/',
          data: {'csrfmiddlewaretoken': '{{ csrf_token }}', },
        })
      }
    }
  })
    if ($(window).width() < 601) {
      console.log("START HIDE")
      $('#quick_suggestions').hide()
    }


  }
  if(window.addEventListener){
    window.addEventListener('load',startClock,false); //W3C
  }
  else{
    window.attachEvent('onload',startClock); //IE
  }
</script>


<script>
  $(document).ready(function(){
    // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
    $('.modal').modal();
    
  });
</script>

<script type="text/javascript">
  $('.smart-back').click(function(){
    window.location.href =  document.referrer;

  })
</script>

<script type="text/javascript">
  $('.add-text-inspiration-btn').click(function() {
    console.log("ADD BUTTON CLICKED")
    var text_id_button = $(this).attr('id')
    var text_id_button_id = $(this).attr('id').split("_")[1]
    console.log("text_id_button" + text_id_button)
    console.log("text_id_button_id" + text_id_button_id)
    
    $.ajax({
      type: 'POST',
      url: '/consumer/inspiration_indvidual_text/',
      data: {'csrfmiddlewaretoken': '{{ csrf_token }}',
      'selected_texts': $(this).attr('id'),
    },
    success : function(data) {
      if (data['save_type'] == "removed"){
        console.log("REMOVED")
        $("#_{{working_text.id}}").html('<span> <i class="fa fa-plus" aria-hidden="true"></i> </span>')
        $('#output_message').html('Text Removed')
        

      } else {
        console.log("ADD")
        
        $("#_{{working_text.id}}").html('<span> <i class="material-icons" >delete</i> </span>')
        $('#output_message').html('Text Added')

      }

    }
  })
  })
</script>


<script>
  $(document).ready(function() {
    $('#text_data_table').DataTable(
    {
      "bLengthChange": false,
      "pageLength": 10,
      "order": [[ 0, "desc" ]],

    });
  } );
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85360122-1', 'auto');
  ga('send', 'pageview');

</script>
{% endblock %}